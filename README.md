# ESP32 MQTT Bluetooth Hub

**ESP32 MQTT Bluetooth Hub** ‚Äî —ç—Ç–æ –ø—Ä–æ—à–∏–≤–∫–∞ –¥–ª—è ESP32, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å Bluetooth-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–º–∞—Ä—Ç-–ª–∞–º–ø—ã), —É–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –ø–∏—Ç–∞–Ω–∏–µ–º –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —á–µ—Ä–µ–∑ MQTT-–±—Ä–æ–∫–µ—Ä.  
–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ Bluetooth-—É—Å—Ç—Ä–æ–π—Å—Ç–≤.
- –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ BLE-–ª–∞–º–ø–∞–º–∏ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ, —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ —è—Ä–∫–æ—Å—Ç–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ RGB-—Ü–≤–µ—Ç–∞.
- –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å –ø–æ MQTT ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø—É–±–ª–∏–∫—É–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MQTT Auto Discovery (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å Home Assistant) ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Home Assistant –±–µ–∑ —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- –†–µ–∑–µ—Ä–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Wi-Fi —Å Captive Portal ‚Äî –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–æ–∑–¥–∞—ë—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Wi-Fi —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ MQTT –∏ BLE —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.
- –§–∏–∑–∏—á–µ—Å–∫–∏–π —Å–±—Ä–æ—Å –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è: —É–¥–µ—Ä–∂–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã —á–µ—Ä–µ–∑ HTTP-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã free heap, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π free heap –∏ uptime —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ESP-IDF v6.0.0 (–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å ESP-IDF v5.x –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π).
- ESP32
- MQTT broker.
  
## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è 

### Wi-Fi
–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Wi-Fi –∏–ª–∏ –µ—Å–ª–∏ –Ω–µ —É–¥–∞—ë—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Wi-Fi, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤–∫–ª—é—á–∏—Ç—å —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ —Å Captive Portal –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–µ—Ç–∏.

### Login
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫ Wi-Fi.
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ "esp32.local" –∏–ª–∏ "http://<IP‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞>".
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å.
   **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
   - Username: admin
   - Password: admin
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã –ø–æ–ø–∞–¥—ë—Ç–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫, –≥–¥–µ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.
   
 –î–ª—è —Å–±—Ä–æ—Å–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–æ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
 —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ BOOT/FLASH –∫–Ω–æ–ø–∫—É –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥.
   - —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å**.
   - –ù–∞–∂–º–∏—Ç–µ –∏ —É–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É BOOT –≤ —Ç–µ—á–µ–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥.

### MQTT
MQTT –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫ Wi-Fi.  
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ "esp32.local" –∏–ª–∏ "http://<IP‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞>".
3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—Ö–æ–¥–∞ –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—å.
4. –í–≤–µ–¥–∏—Ç–µ:
   - **Broker URL** ‚Äî –∞–¥—Ä–µ—Å MQTT-–±—Ä–æ–∫–µ—Ä–∞.  
   - **Discovery Prefix** ‚Äî –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).  
   - **Username** ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è MQTT (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).  
   - **Password** ‚Äî –ø–∞—Ä–æ–ª—å –¥–ª—è MQTT (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).  
5. –ù–∞–∂–º–∏—Ç–µ "Save & apply MQTT configuration" ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ä–∞–∑—É, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

### BLE
–ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
  - –ò–º—è Bluetooth-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (GATT-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)
  - —É—Ä–æ–≤–µ–Ω—å –º–æ—â–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏ BLE 
—á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ MQTT.
1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ "esp32.local" –∏–ª–∏ "http://<IP‚Äë—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞>".
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É BLE.
3. –í–≤–µ–¥–∏—Ç–µ:
   - Device Name ‚Äî –∏–º—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∫ –∫–æ—Ç–æ—Ä–æ–º—É —Ö–æ—Ç–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è.  
   - BLE Power ‚Äî —É—Ä–æ–≤–µ–Ω—å –º–æ—â–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏ (-12, -9, -6, -3, 0, +3, +6, +9 dBm).
3. –ù–∞–∂–º–∏—Ç–µ "Save & apply BLE configuration" ‚Äî —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ä–∞–∑—É, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏.

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
esp32_mqtt_btHub/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt
‚îÇ   ‚îú‚îÄ‚îÄ device_manager.c     ‚Üê –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å BLE-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ dns_server.c
‚îÇ   ‚îú‚îÄ‚îÄ httpd_manager.c
‚îÇ   ‚îú‚îÄ‚îÄ idf_component.yml
‚îÇ   ‚îú‚îÄ‚îÄ system_metrics.c
‚îÇ   ‚îú‚îÄ‚îÄ mqtt_manager.c       ‚Üê –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å MQTT –∏ –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ wifi_manager.c       ‚Üê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wi-Fi, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π —Å–µ—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ esp32_mqtt_btHub.c   ‚Üê main
‚îÇ   ‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ device_manager.h
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dns_server.h
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ httpd_manager.h
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ system_metrics.h
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mqtt_manager.h
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ wifi_manager.h   
‚îÇ   ‚îî‚îÄ‚îÄ web/
‚îÇ       ‚îú‚îÄ‚îÄ index.css
‚îÇ       ‚îú‚îÄ‚îÄ index.html
‚îÇ       ‚îú‚îÄ‚îÄ index.js
‚îÇ       ‚îú‚îÄ‚îÄ index.json
‚îÇ       ‚îú‚îÄ‚îÄ login.html
‚îÇ       ‚îî‚îÄ‚îÄ login.js  
‚îú‚îÄ‚îÄ CMakeLists.txt
‚îú‚îÄ‚îÄ sdkconfig
‚îú‚îÄ‚îÄ partitions.cvs
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```
