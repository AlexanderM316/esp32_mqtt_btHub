<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ESP32 Configuration</title>
  <link rel="stylesheet" href="index.css">
</head>
<body>
  <header>
     <h1>ESP32 Configuration</h1>
  </header>
  <main>
    <div class="tabs">
        <button class="tab-button active" data-tab="mqtt">MQTT</button>
        <button class="tab-button" data-tab="ble">BLE</button>
        <button class="tab-button" data-tab="login">Login</button>
        <button class="tab-button" data-tab="system">System</button>
    </div>
    <div id="mqtt" class="tab-content active">
     <h2>MQTT Configuration</h2>
      <form id="mqtt-form">
        <div class="form-group">
          <label for="broker">Broker URL:</label>
          <input type="text" id="broker" name="broker" minlength="3" maxlength="63" required>
        </div>
        <div class="form-group">
          <label for="prefix">Discovery Prefix:</label>
          <input type="text" id="prefix" name="prefix" maxlength="31">
        </div>
        <div class="form-group">
          <label for="user">Username:</label>
          <input type="text" id="user" name="user" maxlength="31">
        </div>
        <div class="form-group">
          <label for="pass">Password:</label>
          <input type="password" id="pass" name="pass" maxlength="31">
        </div>
        <input type="submit" value="Save & apply MQTT configuration">
      </form>
      <p id="mqtt-status"></p>
    </div>
    <div id="ble" class="tab-content">
     <h2>BLE Configuration</h2>
     <form id="ble-form">
      <div class="form-group">
        <label for="by_name">Filter by name?</label>
        <input type="checkbox" id="by_name" name="by_name">
        <input type="text" id="device_name" name="device_name" maxlength="31">
      </div>
      <div class="form-group">
        <label for="tx_power">BLE Power:</label>
        <select id="tx_power" name="tx_power">
          <option value=0>-12 dbm</option>
          <option value=1>-9 dbm</option>
          <option value=2>-6 dbm</option>
          <option value=3>-3 dbm</option>
          <option value=4> 0 dbm</option>
          <option value=5> 3 dbm</option>
          <option value=6> 6 dbm</option>
          <option value=7> 9 dbm</option>
        </select>
      </div>
      <div class="form-group">
        <label for="interval">Scan Interval:</label>
        <input type="number" id="interval" name="interval" min="1" max="255">
        <small>Time between scans (1-255 seconds)</small>
      </div>
      <div class="form-group">
        <label for="duration">Scan Duration:</label>
        <input type="number" id="duration" name="duration" min="1" max="255">
        <small>How long each scan lasts (1-255 seconds)</small>
      </div>
      <div class="form-group">
        <label for="mtu">MTU:</label>
        <input type="number" id="mtu" name="mtu" min="23" max="517">
        <small>MTU size (23-517 bytes)</small>
      </div>
      <input type="submit" value="Save & apply BLE configuration">
     </form>
     <p id="ble-status"></p>
    </div>
    <div id="login" class="tab-content">
     <h2>Login Configuration</h2>
     <form id="set-login-form">
      <div class="form-group">
        <label for="new_name">New username:</label>
        <input type="text" id="new_name" name="new_name" minlength="4" maxlength="15" required>
      </div>
      <div class="form-group">
        <label for="new_pass">New password:</label>
        <input type="password" id="new_pass" name="new_pass" minlength="4" maxlength="15" required>
      </div>
      <input type="submit" value="Save new login">
     </form>
     <p id="set-login-status"></p>
    </div>
    <div id="system" class="tab-content">
      <h2>System Metrics</h2> 
      <div class="heap-header">
       Total Heap: <span id="total_heap">0</span> bytes
      </div>
      <div class="progress-container">
       <div id="heap-bar" class="progress-bar">
         <span id="heap-used">0% (0 bytes used)</span>
       </div>
       <span id="heap-free">0 bytes free</span>
      </div>
      <p>Min Free: <span id="min_heap"></span> bytes</p>
      <p>Uptime: <span id="uptime"></span></p>
      <h2>BLE Metrics</h2>
      <p>Devices: <span id="conn_count"></span> connected / <span id="discovered_count"></span> discovered</p>
      <table id="devices-table">
        <thead><tr><th>Index</th><th>Name</th><th>MAC</th><th>Status</th></tr></thead>
        <tbody id="devices-table-body"></tbody>
      </table>
    </div>
  </main>
  <script src="index.js"></script>
</body>
</html>
